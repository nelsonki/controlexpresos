<div class="container-fluid prod-container-table">

    <div class="nav-menu-top">
        <nav class="navbar  navbar-expand-lg navbar-dark mat-toolbar mat-primary nav-padding-option">
            <div class="table-title-width">
                <div>
                    <mat-icon height="38px">arrow_circle_up</mat-icon>

                </div>
                <div>
                    &nbsp; Salidas
                </div>
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto col-lg-9 col-md-9 col-sm-9 col-xs-9">
                    <li class="nav-item   button-li-top col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <a class="pointer" (click)="Refresh()">
                            <button *ngIf="true" mat-mini-fab color="white" matTooltip="Refrescar Tabla" data-toggle="tooltip" data-placement="left">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </a>
                    </li>
                    <li class="nav-item   button-li-top col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <a class="pointer" (click)="exportTo()">
                            <button class="opAut-button-excel" mat-mini-fab color="white" matTooltip="Exportar a Excel" data-toggle="tooltip" data-placement="left">
                                <svg style="width:20px;height:20px;" viewBox="0 0 24 24">
                                    <path fill="#ffff"
                                      d="M6,2H14L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M13,3.5V9H18.5L13,3.5M17,11H13V13H14L12,14.67L10,13H11V11H7V13H8L11,15.5L8,18H7V20H11V18H10L12,16.33L14,18H13V20H17V18H16L13,15.5L16,13H17V11Z" />
                                  </svg>
                            </button>
                        </a>

                    </li>
                    <li class="nav-item   button-li-top col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <a class="pointer" (click)="filtrarOperacion()">
                            <button mat-mini-fab color="white" matTooltip="Filtro Avanzado" data-toggle="tooltip" data-placement="left">
                                <i class="fas fa-filter"></i>
                            </button>
                        </a>

                    </li>

                    <li class="nav-item  button-li-top2 col-lg-4 col-md-4 col-sm-4 col-xs-4">
                        <app-date-range (dateNow)="DateFilter($event)"></app-date-range>
                    </li>
                    <li class="nav-item   button-li-top3  col-lg-4 col-md-4 col-sm-4 col-xs-4 tpeso">
                        Total peso de salidas: {{ total_weight_out }}
                    </li>

                </ul>

                <span class="navbar-text button-li-top">
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <mat-form-field width="40px">
                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Buscar" />
              </mat-form-field>
            </div>

            <!--<div class="col-lg-7 col-md-5 col-sm-5 col-xs-5 text-right">
              <a class="pointer" (click)="exportTo('xls')">
                <button class="opAut-button-excel" mat-mini-fab color="white" matTooltip="Exportar a Excel"
                  data-toggle="tooltip" data-placement="left">
                  <svg style="width:20px;height:20px;" viewBox="0 0 24 24">
                    <path fill="#ffff"
                      d="M6,2H14L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M13,3.5V9H18.5L13,3.5M17,11H13V13H14L12,14.67L10,13H11V11H7V13H8L11,15.5L8,18H7V20H11V18H10L12,16.33L14,18H13V20H17V18H16L13,15.5L16,13H17V11Z" />
                  </svg>
                </button>
              </a>
            </div>-->
          </div>
        </span>
            </div>
        </nav>
    </div>


    <div class="prod-scroll-table">
        <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8  ">

            <!-- Position Column -->
            <ng-container matColumnDef="Item">
                <th mat-header-cell *matHeaderCellDef> Item </th>
                <td mat-cell *matCellDef="let element"> {{element.Item}}</td>
            </ng-container>
            <!-- Position Column -->
            <ng-container matColumnDef="ID">
                <th mat-header-cell *matHeaderCellDef> ID </th>
                <td mat-cell *matCellDef="let element"> {{element.id}} </td>
            </ng-container>
            <!-- Name Column -->
            <ng-container matColumnDef="Cliente - Sucursal">
                <th mat-header-cell *matHeaderCellDef> Cliente - Sucursal </th>
                <td mat-cell *matCellDef="let element"> {{element.client_name}} - {{element.branch_name}} </td>
            </ng-container>

            <!-- Weight Column -->
            <ng-container matColumnDef="Fecha - Hora">
                <th mat-header-cell *matHeaderCellDef> Fecha - Hora </th>
                <td mat-cell *matCellDef="let element"> {{element.date_time}}</td>
            </ng-container>
            <ng-container matColumnDef="Peso de salida">
                <th mat-header-cell *matHeaderCellDef> Peso de salida </th>
                <td mat-cell *matCellDef="let element" style="text-align:center"> {{element.weight_out}} </td>
            </ng-container>
            <!-- Weight Column -->
            <ng-container matColumnDef="Usuario">
                <th mat-header-cell *matHeaderCellDef> Usuario </th>
                <td mat-cell *matCellDef="let element"> {{element.user}}</td>
            </ng-container>
            <!-- Weight Column -->
            <!--
            <ng-container matColumnDef="Observaci贸n">
                <th mat-header-cell *matHeaderCellDef> Observaci贸n </th>
                <td mat-cell *matCellDef="let element">{{element.observation}} </td>
            </ng-container>-->
            <!-- Weight Column -->
            <ng-container matColumnDef="Acciones">
                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                <td mat-cell *matCellDef="let element">
                    <div class="row text-center purchase-width-actions">
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Agregar Salidas Parciales" (click)="openEdit(element.id); basicModal.show()">
                            <mat-icon height="28px">arrow_circle_up</mat-icon>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Cerrar operaci贸n" (click)="cerrarOp(element.id)">
                            <mat-icon height="28px">archive</mat-icon>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Imprimir operaci贸n" (click)="print(element.id)">
                            <mat-icon height="28px">print</mat-icon>
                        </div>
                        <!--
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Eliminar" (click)="eliminar(element.id)">
                            <i class="far fa-trash-alt"></i>

                        </div>-->
                    </div>


                </td>
            </ng-container>

            <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                    <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                        <div class="table-responsive">

                            <h3 class="text-center"> Listado de Operaciones de Entradas </h3>

                            <table [dataSource]="dataSource" class="table table-bordered " style="width: 100%;">
                                <caption>
                                    Observaciones de entrada: {{ element.observation }}
                                </caption>

                                <tr>
                                    <th>Item</th>
                                    <th>Peso</th>
                                    <th>Cantidad</th>
                                    <th>Servicio</th>
                                    <th>Color</th>
                                    <th>Sub Servicio</th>
                                    <th>Tipo de Ropa</th>
                                    <th>Fecha y Hora</th>


                                </tr>
                                <ng-container *ngFor="let input of element.inputs; let id2 = index">
                                    <tr>
                                        <td>{{id2+1}}</td>
                                        <td>{{input.weight}}</td>
                                        <td>{{input.quantity}}</td>
                                        <td>{{input.service_name}}</td>
                                        <td>{{input.color_name}}</td>
                                        <td>{{input.subservices_tag}}</td>
                                        <td>{{input.operation_type}}</td>
                                        <td>{{input.created_at}}</td>


                                    </tr>
                                </ng-container>

                            </table><br>
                            <h3 class="text-center"> Listado de Salidas Parciales </h3>
                            <table [dataSource]="dataSource" class="table table-bordered " style="width: 100%;">
                                <caption>
                                    Observaciones de salida: {{ element.obs_out }}
                                </caption>
                                <ng-container *ngFor="let grupo of element.grupos; let id2 = index">

                                    <tr>
                                        <th colspan="6"> Salida Parcial: {{grupo.group_id}}
                                        </th>

                                        <th>Acciones</th>
                                        <th mat-cell>
                                            <div class="row text-center purchase-width-actions">
                                                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Editar Salida Parcial" (click)="openEditParcial(element.id, grupo.group_id); basicModal.show()">
                                                    <i class="fas fa-edit"></i>
                                                </div>

                                                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Imprimir Salida Parcial" (click)="printParcial(element.id, grupo.group_id)">
                                                    <i class="fas fa-print"></i>
                                                </div>

                                                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 purchase-buttom-edit pointer" matTooltip="Eliminar Salida Parcial" (click)="eliminarGrupo(grupo.group_id)">
                                                    <i class="far fa-trash-alt"></i>
                                                </div>
                                            </div>

                                        </th>

                                    </tr>
                                    <tr>
                                        <th>Item</th>
                                        <th>Peso</th>
                                        <th>Cantidad</th>
                                        <th>Servicio</th>
                                        <th>Color</th>
                                        <th>Sub Servicio</th>
                                        <th>Tipo de Ropa</th>
                                        <th>Fecha y Hora</th>



                                    </tr>



                                    <ng-container *ngFor="let outputsG of grupo.values; let id2 = index">

                                        <tr>
                                            <td>{{id2+1}}</td>
                                            <td>{{outputsG.weight}}</td>
                                            <td>{{outputsG.quantity}}</td>
                                            <td>{{outputsG.service_name}}</td>
                                            <td>{{outputsG.color_name}}</td>
                                            <td>{{outputsG.subservices_tag}}</td>
                                            <td>{{outputsG.operation_type}}</td>
                                            <td>{{outputsG.created_at}}</td>



                                        </tr>


                                    </ng-container>
                                    <tr>
                                        <th> Totales Parciales</th>
                                        <th>{{grupo.subPeso}}</th>
                                        <th>{{grupo.subCantidad}}</th>
                                        <th colspan="5"> </th>





                                    </tr>
                                    <br>

                                </ng-container>

                            </table>
                            <br>
                        </div>


                    </div>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="example-element-row" [class.example-expanded-row]="expandedElement === element" (click)="expandedElement = expandedElement === element ? null : element">
            </tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
        </table>
    </div>
    <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>


    <div class="btn-group">
        <button id="boton" matTooltip="{{ titleModal }}" (click)="basicModal.show(); reset(); showModal()" mat-mini-fab color="primary" class="btn btn-fab" data-toggle="tooltip" data-placement="left" data-original-title="" title="" id="main">
            <mat-icon height="22px">arrow_circle_up</mat-icon>
        </button>
    </div>
    <div id="modal" mdbModal #basicModal="mdbModal" class="modal fade right modal-scroll" tabindex="-1" role="dialog" aria-labelledby="myBasicModalLabel" aria-hidden="true" [config]='{backdrop: false, ignoreBackdropClick: false}' style="overflow: auto;">
        <div class="modal-dialog modal-lg modal-full-height modal-right" style="
        margin-top: 1px !important;" role="document">
            <div class="modal-content">
                <div class="modal-header mat-toolbar mat-primary mat-toolbar-single-row" color="primary">
                    <button type="button" class="close modal-button pull-right" aria-label="Close" (click)="closeModals($event)">
                        <span aria-hidden="true"   class="client-buttom-close"> x </span>
                    </button>
                    <h4 class="modal-title w-100" id="myModalLabel">
                        <mat-icon height="38px">arrow_circle_up</mat-icon>
                        {{ titleModal }}
                        <!--<img src="assets/menuIcons/tags.png" alt="" height="22px" /> {{ titleModal }}-->
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="container">
                            <div class="col-xs-12 col-sm-12">
                                <app-salidas-form (statusCloseModal)="closeModals($event)" [element]="element"> </app-salidas-form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>